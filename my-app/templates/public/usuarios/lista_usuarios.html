{% extends 'public/base_cpanel.html' %}

{% block title %}CRUD - Python 🐍 | Lista de Usuarios{% endblock %}

{% block body %}
{% if resp_usuariosBD %}
<div class="card shadow-sm mt-4 mb-5">
  <div class="card-header bg-dark text-white text-center">
    <h4 class="mb-0">👥 Lista de Usuarios Creados</h4>
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table id="tablaUsuarios" class="table table-striped table-bordered align-middle">
        <thead class="table-dark text-center">
          <tr>
            <th>Usuario</th>
            <th>Email</th>
            <th>Fecha de creación</th>
            <th>Acción</th>
          </tr>
        </thead>
        <tbody>
          {% for usuario in resp_usuariosBD %}
          <tr>
            <td>{{ usuario.name_surname }}</td>
            <td>{{ usuario.email_user }}</td>
            <td>{{ usuario.created_user }}</td>
            <td class="text-center">
              <button class="btn btn-sm btn-outline-danger" onclick="eliminarUsuario('{{ usuario.id }}')">
                <i class="bi bi-trash3-fill"></i>
              </button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% else %}
<div class="alert alert-warning text-center mt-5">
  <h5>No hay usuarios registrados 😭</h5>
</div>
{% endif %}
{% endblock %}

{% block customJS %}
<!-- DataTables CDN -->
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" />

<script>
  // Inicializar DataTables
  $(document).ready(function () {
    $('#tablaUsuarios').DataTable({
      language: {
        url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
      }
    });
  });

  // Función para eliminar usuario
  function eliminarUsuario(id) {
    if (confirm("¿Estás seguro que deseas eliminar este usuario?")) {
      window.location.href = `/borrar-usuario/${id}`;
    }
  }
</script>
{% endblock %}
